properties([[$class: 'JiraProjectProperty'], buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '5', numToKeepStr: '5')), [$class: 'JobLocalConfiguration', changeReasonComment: ''], pipelineTriggers([pollSCM('* * * * *')])])
pipeline {
    agent any
    tools {
    maven 'Maven_Home.3.6.3'
    }

    stages {
        stage("scm checkot") {
            steps {
                git branch: 'stage', credentialsId: 'github_id', url: 'https://github.com/githubjigalooru/maven-web-application_o.git'
            }
        }
        stage("MVN package") {
            steps {
            sh "mvn clean package"
            }
        }
        stage("docker image create") {
            steps {
            sh label: '', script: 'docker build -t ravikumara0004/application .'    
            
            }
        }
        stage("docker_image_push") {
            steps {
            withCredentials([string(credentialsId: 'dock_pass_ID', variable: 'docker_hub_cred')]) {
            sh label: '', script: 'docker login -u ravikumara0004 -p ${docker_hub_cred}'
            }
            sh label: '', script: 'docker push ravikumara0004/application'
                
            }
        }
        stage("dockerimage+pull") {
          steps {
          sshagent(['dockerswarm']) {
          sh label: '', script: 'ssh -o StrictHostKeyChecking=no ubuntu@35.154.243.11 docker rmi ravikumara0004/application || true'
          }
	      sh label: '', script: 'docker pull ravikumara0004/application'
	       }
       }
    }
}
